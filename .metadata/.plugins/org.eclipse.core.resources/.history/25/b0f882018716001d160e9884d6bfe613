package services;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;

import entities.Ator;
import entities.Diretor;
import entities.Filme;
import repositories.AtorRepository;
import repositories.DiretorRepository;
import repositories.FilmeRepository;

public class FilmeService {
	
	private FilmeRepository fr;
	private AtorRepository ar;
	private DiretorRepository dr;
	
	public FilmeService() {
		this.fr = new FilmeRepository();
		this.ar = new AtorRepository();
		this.dr = new DiretorRepository();
	}
	
	public boolean addFilme(String nome, String diretor, 
			String[] elenco, float nota) {
		
		// Adicione diretor na lista de diretores
		this.addDiretor(diretor);
		
		HashSet<Ator> atores = new HashSet<Ator>();
		
		// Adiciona atores na lista de atores e tambem
		// na lista a ser incluida no objeto filme
		for(int i = 0; i < elenco.length; i++) {
			this.addAtor( elenco[i] );
			atores.add( new Ator(elenco[i]) );
		}
		
		Filme filme = new Filme(nome, new Diretor(diretor), atores, nota);
		
		return fr.addFilme(filme);
	}
	
	public List<Filme> listaFilmesPorDiretor(String diretor){
		
		ArrayList<Filme> filmesFiltrados = new ArrayList<Filme>();
		
		HashSet<Filme> filmes = this.fr.getFilmes();
		
		Iterator<Filme> i = filmes.iterator();
		
		while(i.hasNext()) {
			Filme f = i.next();
			
			if(f.getDiretor().equals(diretor)) {
				filmesFiltrados.add(new Filme(f));
			}
		}
		
		return filmesFiltrados;
	}
	
	public List<Filme> listaFilmesPorAtor(String ator){
		
		ArrayList<Filme> filmesFiltrados = new ArrayList<Filme>();
		
		HashSet<Filme> filmes = this.fr.getFilmes();
		
		Iterator<Filme> i = filmes.iterator();
		
		while(i.hasNext()) {
			Filme f = i.next();
			
			Iterator<Ator> j = f.getElenco().iterator();
			
			while(j.hasNext()) {				
				Ator a = j.next();
				
				if(a.getNome().equals(ator)) {
					filmesFiltrados.add(f);
					break;
				}				
			}
		}
		
		return filmesFiltrados;
	}
	
	public boolean addAtor(String nome) {
		return this.ar.addAtor(new Ator(nome));
	}
	
	public boolean removeAtor(String nome) {
		return this.ar.removeAtor(new Ator(nome));
	}
	
	public Ator getAtor(String nome) {
		return ar.getAtor(nome);
	}
	
	public Ator[] listaAtores(){
		return (Ator[]) this.ar.getAtores().toArray();
	}
	
	public boolean addDiretor(String nome) {
		return this.dr.addDiretor(new Diretor(nome));
	}
	
	public boolean removeDiretor(String nome) {
		return this.dr.removeDiretor(new Diretor(nome));
	}
	
	public Ator[] listaDiretores(){
		return (Ator[]) this.dr.getDiretores().toArray();
	}
}
